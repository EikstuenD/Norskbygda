<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alkymistens Laboratorium</title>
    <style>
        /* DESIGN OG UTSEENDE */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
            touch-action: manipulation; /* Forhindrer zooming p√• iPad */
        }

        #game-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Startskjerm */
        .screen {
            display: none; /* Skjuler alle skjermer som standard */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .active {
            display: flex; /* Viser den aktive skjermen */
        }

        input {
            padding: 15px;
            font-size: 18px;
            border-radius: 10px;
            border: none;
            margin-bottom: 20px;
            text-align: center;
        }

        button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px #1e8449;
            transition: all 0.1s;
            margin: 5px;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 0 #1e8449;
        }

        button.ingredient {
            background-color: #8e44ad;
            box-shadow: 0 4px #6c3483;
            width: 70px;
            height: 70px;
            font-size: 24px;
            font-weight: bold;
        }

        button.action-btn {
            background-color: #e67e22;
            box-shadow: 0 4px #d35400;
        }

        button.clear-btn {
            background-color: #c0392b;
            box-shadow: 0 4px #922b21;
        }

        /* Spill-elementer */
        .customer-bubble {
            background-color: white;
            color: #333;
            padding: 20px;
            border-radius: 20px;
            position: relative;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: bold;
        }
        
        .customer-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 0;
            border: 20px solid transparent;
            border-top-color: white;
            border-bottom: 0;
            margin-left: -20px;
            margin-bottom: -20px;
        }

        .cauldron-area {
            background: #34495e;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            border: 5px solid #7f8c8d;
            font-size: 40px;
            color: #f1c40f;
            flex-direction: column;
        }

        .cauldron-label {
            font-size: 14px;
            color: #bdc3c7;
            margin-bottom: 5px;
        }

        .ingredients-rack {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 15px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .feedback {
            height: 30px;
            color: #f1c40f;
            font-weight: bold;
        }

        /* Leaderboard styling */
        .leaderboard-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            width: 80%;
            text-align: left;
        }
        .leaderboard-box ol {
            padding-left: 20px;
        }

    </style>
</head>
<body>

<div id="game-container">
    
    <div id="start-screen" class="screen active">
        <h1>‚öóÔ∏è Alkymistens Lab ‚öóÔ∏è</h1>
        <p>Skriv inn navnet ditt, l√¶rling:</p>
        <input type="text" id="player-name" placeholder="Ditt navn..." maxlength="12">
        <button onclick="startGame()">Start Spillet</button>
        
        <div class="leaderboard-box">
            <h3>üèÜ Lokal Toppliste (p√• denne iPaden)</h3>
            <ol id="start-leaderboard"></ol>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="status-bar">
            <span id="display-name">Spiller: ...</span>
            <span id="display-score">XP: 0</span>
            <span id="display-level">Niv√•: 1</span>
        </div>

        <div class="customer-bubble">
            <span id="quest-text">Jeg trenger eliksir 12!</span>
        </div>

        <div class="cauldron-area">
            <span class="cauldron-label">I gryta n√•:</span>
            <span id="current-brew">1</span>
        </div>
        
        <div id="feedback-msg" class="feedback"></div>

        <div class="ingredients-rack">
            <p>Tilsett ingredienser:</p>
            <div>
                <button class="ingredient" onclick="addIngredient(2)">2</button>
                <button class="ingredient" onclick="addIngredient(3)">3</button>
                <button class="ingredient" onclick="addIngredient(5)">5</button>
                <button class="ingredient" id="btn-7" style="display:none;" onclick="addIngredient(7)">7</button>
            </div>
            <div style="margin-top: 15px;">
                <button class="clear-btn" onclick="clearCauldron()">T√∏m gryta</button>
                <button class="action-btn" onclick="submitBrew()">BLAND!</button>
            </div>
        </div>
    </div>

    <div id="end-screen" class="screen">
        <h1>Tiden er ute!</h1>
        <h2>Du fikk <span id="final-score" style="color: #f1c40f">0</span> XP</h2>
        <p>Vis denne skjermen til l√¶reren for √• komme p√• tavla!</p>
        <button onclick="goToStart()">Spill igjen</button>
    </div>

</div>

<script>
    // SPILLVARIABLER
    let playerName = "";
    let score = 0;
    let currentBrew = 1;
    let targetNumber = 0;
    let level = 1;
    let questionsAnswered = 0;
    let maxQuestions = 10; // Hvor mange oppgaver f√∏r spillet er slutt?

    // PRIMTALLSLISTE
    const primes = [2, 3, 5, 7];

    // OPPSTART
    function init() {
        updateLeaderboardDisplay();
    }

    function startGame() {
        const inputName = document.getElementById('player-name').value;
        if (inputName.trim() === "") {
            alert("Du m√• skrive et navn!");
            return;
        }
        playerName = inputName;
        score = 0;
        level = 1;
        questionsAnswered = 0;
        document.getElementById('display-name').innerText = "Alkymist: " + playerName;
        
        // Vis spillskjerm
        switchScreen('game-screen');
        newRound();
    }

    // NY RUNDE LOGIKK
    function newRound() {
        if (questionsAnswered >= maxQuestions) {
            endGame();
            return;
        }

        clearCauldron();
        document.getElementById('display-score').innerText = "XP: " + score;
        document.getElementById('display-level').innerText = "Niv√•: " + level;
        
        // Vanskelighetsgrad
        if (score > 100) level = 2;
        if (score > 300) level = 3;

        // Vis knapp 7 hvis niv√• 2+
        if (level >= 2) document.getElementById('btn-7').style.display = 'inline-block';
        else document.getElementById('btn-7').style.display = 'none';

        // Generer et tall basert p√• niv√•
        targetNumber = generateTarget(level);
        
        // Lag tekst
        document.getElementById('quest-text').innerText = "Lag Eliksir " + targetNumber + "!";
    }

    function generateTarget(lvl) {
        // Enkel logikk for √• generere tall som KAN faktoriseres
        let factors = [];
        let limit = (lvl === 1) ? 3 : 4; // Hvor mange faktorer
        let availablePrimes = (lvl === 1) ? [2, 3, 5] : [2, 3, 5, 7];

        // S√∏rg for at vi har minst to faktorer
        let numFactors = Math.floor(Math.random() * limit) + 2; 

        let product = 1;
        for (let i = 0; i < numFactors; i++) {
            let p = availablePrimes[Math.floor(Math.random() * availablePrimes.length)];
            // Unng√• at tallet blir for stort (over 100 p√• niv√• 1)
            if (product * p > 100 && lvl === 1) break;
            product *= p;
        }
        // Sikkerhetsnett: hvis produktet ved et uhell er primtall (skjer ikke med logikken over men greit √• ha) eller for lite
        if (product < 4) return 6; 
        return product;
    }

    // SPILLER HANDLINGER
    function addIngredient(p) {
        currentBrew *= p;
        updateCauldron();
    }

    function clearCauldron() {
        currentBrew = 1;
        updateCauldron();
        setMessage("");
    }

    function updateCauldron() {
        document.getElementById('current-brew').innerText = currentBrew;
        // Visuell feedback hvis tallet blir for h√∏yt
        if (currentBrew > targetNumber) {
            document.getElementById('current-brew').style.color = "#e74c3c"; // R√∏d
        } else {
            document.getElementById('current-brew').style.color = "#f1c40f"; // Gul
        }
    }

    function submitBrew() {
        if (currentBrew === targetNumber) {
            // RIKTIG
            let points = 10 * level;
            score += points;
            setMessage("‚ú® Perfekt! +" + points + " XP");
            questionsAnswered++;
            setTimeout(newRound, 1500); // Vent litt f√∏r neste
        } else {
            // FEIL
            setMessage("üí• Oisann! Det ble " + currentBrew + ", ikke " + targetNumber);
            document.getElementById('current-brew').style.color = "red";
            score = Math.max(0, score - 5); // Minuspoeng men ikke under 0
            document.getElementById('display-score').innerText = "XP: " + score;
        }
    }

    function setMessage(msg) {
        document.getElementById('feedback-msg').innerText = msg;
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // AVSLUTT OG SCORE
    function endGame() {
        switchScreen('end-screen');
        document.getElementById('final-score').innerText = score;
        saveScore(playerName, score);
    }

    function goToStart() {
        updateLeaderboardDisplay();
        switchScreen('start-screen');
    }

    // LOKAL LAGRING (Local Storage)
    function saveScore(name, score) {
        let scores = JSON.parse(localStorage.getItem('alkymistScores')) || [];
        scores.push({name: name, score: score});
        scores.sort((a, b) => b.score - a.score); // Sorter h√∏yest f√∏rst
        scores = scores.slice(0, 5); // Behold bare top 5
        localStorage.setItem('alkymistScores', JSON.stringify(scores));
    }

    function updateLeaderboardDisplay() {
        let scores = JSON.parse(localStorage.getItem('alkymistScores')) || [];
        let list = document.getElementById('start-leaderboard');
        list.innerHTML = "";
        
        if (scores.length === 0) {
            list.innerHTML = "<li>Ingen mestere enda...</li>";
        } else {
            scores.forEach(s => {
                let li = document.createElement('li');
                li.innerText = s.name + " - " + s.score + " XP";
                list.appendChild(li);
            });
        }
    }

    // Kj√∏r ved start
    init();

</script>

</body>
</html>
